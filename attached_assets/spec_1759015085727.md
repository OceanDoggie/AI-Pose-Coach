# AI Pose Coach — Spec 2.0

> 把「小红书 / Instagram 教程」装进相机里：用自然语言 + 动态小人 + 相似度条，实时教你和摄影师怎么拍，像一位随身的 **AI 拍照教练**。

**Status**: Draft 2.0
**Owners**: @Keren (@contributors)
**Targets**: MVP → v1.5 → v2.0（见 Roadmap）
**Last updated**: 2025-09-01

---

## 0. Elevator Pitch（电梯稿）

让不会摆的会摆、会摆的更出片，让摄影师少试错。通过 **实时姿态对齐 + 机位/光线建议 + 达标自动快门**，把“教程 → 实操”缩短到 **10 秒**。

---

## 1. Scope（范围）

### 1.1 Goals（我们要解决什么）

* 在取景器内 **实时叠加“怎么摆 / 怎么拍”** 的可执行指令。
* 同时面向 **模特** 与 **摄影师** 输出可读、可执行的分角色提示。
* 用 **百分比相似度** 与 **小人演示** 建立清晰的“目标 → 达标”闭环。
* 达标后 **自动快门**，减少错过抓拍与沟通成本。

### 1.2 Non‑Goals（当前不做）

* 深度美颜 / 修图流水线（可与第三方 App 串联）。
* 云端人像存储与人脸识别（默认端侧处理，仅骨架/匿名嵌入可选上传）。
* 专业级 RAW 后期（后续以插件/导出对接）。

---

## 2. Personas & JTBD（目标用户与场景）

* **Z 世代 / 大学生**：旅行与日常记录，社交平台发图。
* **情侣 / 闺蜜互拍**：降低沟通成本。
* **内容创作者 / 小店主**：高效产出高质量“出片”。
* **影楼 / 工作室（B 端）**：标准化指导、批量拍摄。

**典型场景**：校园、海滩、城市街拍、咖啡店、室内窗边、健身房等。

---

## 3. Phased Feature Set（按阶段功能）

### ✅ MVP（必须有）

* 取景器叠加 **骨架/虚线/箭头** 与构图辅助线（九宫格/地平线）。
* **风格/场景/自拍或他拍** 快选。
* **目标 Pose 模板**（若干稳定姿势）。
* **相似度条（0–100%）** 与达标条件（≥阈值 & 稳定 N 帧）。
* **大白话提示**（模特/摄影师双角色）。
* **达标自动快门**（阈值 + 稳定帧数）。
* **本地保存**（无需登录）。

### 🔼 v1.5（增强）

* **小人演示窗**（2D/3D 切换）与逐步分解动画。
* **语音播报** + 倒计时/“3-2-1”触发。
* **机位/光线教练**（距离、机位高度、主光方向）。
* **参考图导入**：把喜欢的照片/短视频解析成 Pose。

### 🚀 v2.0（体验与商业化）

* **多人成像**（情侣、合影阵型）。
* **动作序列/动态轨迹**（走路、回头、甩外套）。
* **风格包市场**（KOL/摄影师上架 Pose/Style Pack）。
* **离线模式**（全离线，隐私优先）。

**Nice to have（体验增强）**：

* 角度级纠偏（示例：“左手再高 10°”）；
* 📸 **多动作连拍引导**（自动切换下一 Pose）。

---

## 4. UX & Screens（关键界面）

### 4.1 主取景区（全屏）

* 叠加骨架、虚线、箭头、关键点；
* 构图辅助：九宫格、地平线检测（陀螺仪/直线检测）。

### 4.2 右侧提示区

* 顶部 **完成度条（0–100%）**；
* 中部 **文字/表情提示**（示例：“左手抬高 10°；眼睛看镜头上沿”）；
* 底部 **小人演示窗**（2D 火柴人 → v1.5 可切 3D）。

### 4.3 底部操作区

* 快门/倒计时、前后摄像头切换、风格/场景选择、参考图导入。

### 4.4 “达标自动拍”微交互

* 达到阈值且稳定 **N 帧（默认 10）** → 蜂鸣 + 轻振动 → 自动快门。

---

## 5. Flows & State Machine（端到端流程）

```
选择 → 解析 → 纠偏 → 达标 → 拍照/复拍 → （序列）下一个动作
```

1. 选择风格/场景/自拍 or 他拍（可跳过）
2. 选择 Pose 模板（或导入参考图）
3. 实时检测：显示骨架 & 百分比
4. 规则引擎输出分角色提示（模特/摄影师）
5. 达标阈值 & 稳定 N 帧 → 自动快门
6. 预览：重拍/保存/加入相册/一键生成“拍摄记录卡”
7. 若为动作序列 → 自动进入下一步

---

## 6. Architecture（技术架构：低成本优先）

### 6.1 Client‑First（推荐）

* **Web PWA（首发）**：React + TypeScript + Vite

  * Camera: `navigator.mediaDevices.getUserMedia`
  * Pose: **MediaPipe Tasks – Pose Landmarker (WASM)**
  * Overlay: **Canvas 2D**
  * TTS: **Web Speech Synthesis**（0 成本）
  * Storage: **IndexedDB**（照片/骨架/设置）
  * Mini‑3D（可选）：Three.js（v1.5）
* **Mobile（第二阶段）**：React Native（Expo）

  * Camera: `react-native-vision-camera`
  * Pose: MediaPipe Tasks（GPU Delegate）
  * TTS: iOS `AVSpeechSynthesizer` / Android `TextToSpeech`

### 6.2 Light Backend（可选）

* **FastAPI** 提供：Pose 模板/风格包元数据、参考图解析（端上不够再回落云端）、日志/埋点与 A/B；
* DB：PostgreSQL（早期可 SQLite）；对象存储：S3 兼容（R2/MinIO）。

**隐私原则**：人像默认 **不出端**；如需云端解析，仅上传 **骨架/匿名嵌入**。

---

## 7. Models & Algorithms（模型与算法）

### 7.1 姿态检测

* **Pose Landmarker（全身 33 点）**；需要面部/手势细度时再启用 Face/Hand Landmarker（避免过度开销）。

### 7.2 相似度评分（0–100%）

**目标**：稳定、可解释、对身高与镜头畸变鲁棒。
**步骤**：

1. **关节角向量**：以肩/肘/髋/膝/踝为核心，计算 3D（可退化为 2D）夹角；
2. **对齐归一化**：以骨盆中心为原点做尺度/旋转对齐（Procrustes）；
3. **加权误差**：不同部位权重（上半身>下半身>手指）；
4. **序列匹配（可选）**：动态姿势用 DTW 对齐时间轴；
5. **转百分比**：`score = max(0, 100 - k * weighted_error)` 并以 EMA 平滑；
6. **稳定判定**：分数 ≥ 阈值 且持续 N 帧 → 触发快门。

**TypeScript 伪代码**：

```ts
interface PoseAngles { [joint: string]: number } // degrees
interface Weights { [region: string]: number }

function poseScore(current: PoseAngles, target: PoseAngles, w: Weights, k=0.8): {score:number, stable:boolean} {
  const errPerJoint = Object.keys(target).map(j => angleDiff(current[j], target[j]));
  const weighted = groupByRegionAndWeight(errPerJoint, w); // 上/下半身等
  const weightedError = l2(weighted);
  const raw = Math.max(0, 100 - k * weightedError);
  const score = ema(raw, 0.4); // EMA 平滑
  const stable = stableFrames(score >= THRESHOLD, N_FRAMES);
  return { score, stable };
}
```

### 7.3 机位/光线教练（规则 + 感知）

* **距离**：人体在画面所占比例 + 等效焦距估算人与机位距离 → “后退半步/再近一点”；
* **高度**：人物眼睛在画面垂直位置推断机位高低 → “机位略低于肚脐”；
* **倾斜/地平线**：直线检测/陀螺仪 → “向右旋 2°”；
* **光向**：面部高光/阴影对比与亮度直方图 → “主光从右上”。

---

## 8. Rules & Prompting（规则引擎与提示生成）

### 8.1 规则样例（if‑else V0）

* `左肘角 < 30° → “左手再伸直一些”`
* `HeadYaw 偏差 > 15° → “头向右转一点”`
* `脸部亮度差 < 阈值 → “让光打在右脸”`

### 8.2 提示模版（双角色）

* **模特**：左手扶鬓，右手叉腰，脚尖交叉，看镜头上沿；
* **摄影师**：退后 0.5 步；机位至腰线；右侧迎光；等“321”。

### 8.3 播报策略

* **节流 + 去抖**：同一建议 **2s** 内不重复；
* 文案档位：**简洁 / 详细**；支持 **中/英** 切换。

---

## 9. Data & Formats（数据与格式）

### 9.1 Pose 模板（JSON Schema）

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "PoseTemplate",
  "type": "object",
  "required": ["id", "name", "angles"],
  "properties": {
    "id": {"type": "string"},
    "name": {"type": "string"},
    "tags": {"type": "array", "items": {"type": "string"}},
    "angles": {"type": "object", "additionalProperties": {"type": "number"}},
    "weights": {"type": "object", "additionalProperties": {"type": "number"}},
    "sequence": {"type": "array", "items": {"type": "string"}},
    "cameraHint": {
      "type": "object",
      "properties": {
        "framing": {"type": "string"},
        "height": {"type": "string"},
        "distance": {"type": "string"},
        "light": {"type": "string"}
      }
    }
  }
}
```

**示例**

```json
{
  "id": "pose_sunshine_001",
  "name": "阳光半身侧身笑",
  "tags": ["阳光", "海滩", "女生"],
  "angles": {"L_elbow": 160, "R_elbow": 90, "HeadYaw": 10},
  "weights": {"upper": 0.6, "lower": 0.4},
  "sequence": ["抬右手触鬓", "左脚前一点", "看镜头上沿"],
  "cameraHint": {"framing": "半身", "height": "肚脐位", "distance": "约1.5m", "light": "右脸受光"}
}
```

### 9.2 参考图/视频解析

* 端上静态图骨架化 → 存 **骨架/角度向量**（不存原图）；
* 多张图 → 组合为 **动作序列**；
* **版权合规**：仅保留结构化骨架与文字，不分发原图。

---

## 10. Metrics & Experiments（指标与实验）

* **A1 激活**：首次拍到 ≥80% 分的照片；
* **A2 成功率**：10 分钟内完成 ≥3 张合格照；
* **留存**：7 天内复拍 ≥2 次；
* **效率**：从进入相机到拍下首张达标照的中位时长；
* **建议命中率**：被采纳的提示 / 总提示。

**实验**：阈值、文案风格、语音 vs 静默、自动 vs 手动快门（A/B）。

**埋点事件（PostHog 示例）**

```json
{
  "event": "pose_score_update",
  "properties": {
    "pose_id": "pose_sunshine_001",
    "score": 86,
    "stable": true,
    "advice": {"model": ["左手再高 10°"], "photographer": ["机位降 5cm"]}
  }
}
```

---

## 11. Privacy & Safety（隐私与合规）

* **默认本地处理**；云端仅在用户授权下工作；
* 可切换“仅存骨架，不存原图”；一键删除；
* **青少年友好**：

  * 避免体态羞辱词汇；
  * 提供“身体中立”提示版本（如“挺直肩背”而非“瘦一点”）。

---

## 12. Performance Targets（性能目标：MVP）

* 姿态检测 **≥ 24 FPS**（中端手机/笔电）；
* 端到端延迟 **≤ 120 ms**；
* 自动快门误触率 **< 2%**；
* 省电：后台暂停检测，息屏停运算。

---

## 13. API Design（后端示例）

### 13.1 Endpoints

* `GET /poses?tag=sunshine` → 返回 Pose 元数据列表；
* `POST /analyze` → 参考图解析 → 返回骨架/角度；
* `POST /score` → 输入实时关键点 → 返回相似度 % 与建议；
* `GET /packs` → 风格包市场元数据。

**/score 返回样例**

```json
{
  "score": 86,
  "stable": true,
  "advice": {
    "model": ["左手再高 10°", "眼睛看镜头上沿"],
    "photographer": ["机位降 5cm", "右侧迎光"]
  },
  "visual": {"arrows": [["L_wrist", "up", 0.1]]}
}
```

### 13.2 错误约定

```json
{"error": {"code": "UNSUPPORTED_MEDIA", "message": "Only JPEG/PNG <= 5MB"}}
```

---

## 14. Testing Strategy（测试）

* **单测（Jest）**：角度计算、Procrustes 对齐、EMA 稳定器；
* **端到端（Cypress）**：相机授权 → 取景渲染 → 分数上升 → 自动快门；
* **性能回归**：FPS/延迟监控；
* **金标用例**：10 张标注图像与 3 组动作序列；
* **可用性走查**：5 名被试完成 3 张达标照任务（记录完成时长与点击路径）。

---

## 15. Repository Layout（仓库结构建议）

```
/ (repo root)
├─ app/                 # React PWA 源码
│  ├─ components/
│  ├─ hooks/
│  ├─ pages/
│  ├─ state/            # Zustand
│  ├─ utils/
│  └─ wasm/             # MediaPipe / WASM 资产
├─ core/                # 算法与规则（可独立为包）
│  ├─ scoring/
│  ├─ rules/
│  └─ types/
├─ poses/               # 内置 Pose 模板 JSON
├─ packs/               # 可选风格/动作包元数据
├─ public/              # PWA 清单 / 图标
├─ docs/                # 文档（白皮书、设计稿、研究）
├─ scripts/             # 构建/发布/数据处理脚本
└─ tests/               # e2e 与基准数据
```

---

## 16. Localization（多语言）

* `i18n` 资源按 **中文/英文** 维护；
* 文案提供 **简洁 / 详细** 两档；
* 身体中立版文案需另有 Key（`copy.neutral.*`）。

---

## 17. Accessibility（无障碍）

* 语音播报 + 触觉反馈；
* 高对比度模式；
* 关键操作（快门/切换）支持大尺寸触控区域。

---

## 18. Roadmap（路线图）

* **Phase A**：Web 端 MVP（取景 + 姿势识别 + 百分比 + 自动快门 + 本地存储）。
* **Phase B**：小人演示、TTS、参考图解析（端上优先）。
* **Phase C**：Pose Pack 市场、账号体系（可匿名）。
* **Phase D**：多人/动作序列/光位高级包、B 端能力。

---

## 19. Risks & Mitigations（风险与对策）

* **遮挡/多人误检**：人体追踪 ID、手动锁定目标；
* **极端光照**：自动提亮或建议换位；
* **设备性能差**：低功耗模式（降低刷新率/关键点数量）；
* **版权**：仅保存骨架/角度；引入创作者入驻机制；
* **学习曲线**：预置“3 步出片”的 **超简模式**。

---

## 20. Open Questions（待定项）

* 机位距离估算的标定流程（等效焦距/人体高度假设）。
* 序列动作的场景切换策略（室内外光差显著时如何提示）。
* Pose/Style Pack 市场的分成、审核与合规细则。

---

## 21. Immediate Next 3（立刻可做）

1. 选 10 个「阳光/可爱/辣妹」**静态 Pose**，写成 JSON 模板；
2. Web PWA 骨架：取景 + MediaPipe + Canvas 叠加 + 相似度条；
3. 规则引擎 V0：整理 15 条常见纠偏（if‑else）并接入播报。

---

## 22. Sample Copy（文案模板）

* **模特**：请把 **左手** 轻扶发鬓，**右手** 叉腰；**左脚** 跨在前；**抬头 10°** 看镜头上沿，**微笑**。
* **摄影师**：请 **退后半步**，机位 **到腰线**；让 **右侧光** 打在脸上；准备 **3‑2‑1**，稳住。

---

## 23. License / Credits（可选）

* 开源许可与第三方库致谢待定（MIT/Apache‑2.0 等）。

> 本 Spec 2.0 对齐《白皮书 2.0》，可用于立项评审、对外介绍与开发落地。
